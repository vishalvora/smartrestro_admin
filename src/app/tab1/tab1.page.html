<!-- <ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      Orders
    </ion-title>
  </ion-toolbar>
</ion-header> -->
<!-- this is new branch V1.0.0 -->
<ion-content [fullscreen]="true">
<div style="max-width:700px; margin:auto">
      <!-- <a (click)="goToLink('https://sites.google.com/view/partnersnvmart/home')">page link</a> -->
    <!-- <div *ngFor= "let p of finalArray">{{p.name}} - {{p.qty}} - {{p.variants[p.selectedVariant].title}}</div> -->
    <!-- <div *ngFor = "let order of ordersFilter; index as i"  > -->


<!-- <ion-button (click)="test()">test</ion-button>
  <div [routerLink]="['/login']"  style="padding:10px; color: blue; text-align: center" >Create New account</div>-->
  <!-- <div [routerLink]="['/slides']"  style="padding:10px; color: blue; text-align: center" >location</div>  -->



  <!-- slides -->
  <!-- <ion-slides [options]="slideOpts" style="padding-top:10px; height:120px; padding-bottom:30px; padding-left:10px; ">
      <ion-slide style="background:salmon; border-radius: 4px; width: 120px; color:white; flex-direction: column">
        <div style="font-size: 40px; font-weight: 100">{{orderAgg?.order_ordered}}</div>
        <div style="font-weight: 100">Ordered</div>
      </ion-slide>
      <ion-slide style="background:salmon; border-radius: 4px; width: 120px; color:white; flex-direction: column">
          <div style="font-size: 40px ; font-weight: 100">{{orderAgg?.order_accepted}}</div>
          <div style="font-weight:100">Accepted</div>
          </ion-slide>
          <ion-slide style="background:salmon; border-radius: 4px; width: 120px; color:white; flex-direction: column">
              <div style="font-size: 40px; font-weight: 100">{{orderAgg?.order_outfordelivery}}</div>
          <div style="font-weight:100; font-size:14px">Out for Delivery</div>
          </ion-slide>
          <ion-slide style="background:salmon; border-radius: 4px; width: 120px; color:white; flex-direction: column">
              <div style="font-size: 40px; font-weight: 100">{{orderAgg?.order_delivered}}</div>
            <div style="font-weight:100">Delivered</div>
              </ion-slide>

    
    </ion-slides> -->


    <!-- bar chart  -->

    <div style="background:#002266; padding:10px;  max-width:700px; margin: auto">
      <div style=" display: flex; background: #002266;
      display: flex;
      text-align: center;
      border: 1px solid blue;
      border-radius: 5px;
      margin: 0 10px;
      font-size:13px;
      color: white;">
        <div style="width:25%; border-right: 1px solid blue;
        /* background: blue; */
        padding: 3px 0;" [style.background] = "currentSelection === 0?'blue':''" (click)="changeSelection(0)">Today</div>
        <div style="width:25%; border-right: 1px solid blue;
        /* background: blue; */
        padding: 3px 0;" [style.background] = "currentSelection === 1?'blue':''" (click)="changeSelection(1)">Yesterday</div>
        <div style="width:25%; border-right: 1px solid blue;
        /* background: blue; */
        padding: 3px 0;" [style.background] = "currentSelection === 2?'blue':''" (click)="changeSelection(2)">This week</div>
        <div style="width:25%; 
        /* background: blue; */
        padding: 3px 0;" [style.background] = "currentSelection === 3?'blue':''" (click)="changeSelection(3)">This month</div>
      </div>
      <div style="text-align: center; padding: 5px; width:100%; color:white">
        <div style="font-size: 14px; padding-bottom:2px">Total sales</div>
        <div style="font-size: 30px; padding-bottom:2px">&#8377; {{sales[currentSelection]}}</div>
        <div style="font-size: 14px; padding-bottom:5px">{{orderCount[currentSelection]}} orders</div>
      </div>
          

    <div style="display: block; background:#002266;">
      <canvas style="padding-right: 10px; padding: 5px 10px 5px 5px;" baseChart [datasets]="barChartData" chartType="bar" [labels]="mbarChartLabels" [options]="barChartOptions"    [colors]="barChartColors"
      ></canvas>
    </div>
  </div>
    <div style="height:10px;"></div>


<div style="display:flex">
<!-- <div style="text-align: center; width:60%">
  <div style="font-size: 14px; padding-bottom:2px">Total sales - this month</div>
  <div style="font-size: 30px; padding-bottom:2px">&#8377; {{monthSales}}</div>
  <div style="font-size: 14px; padding-bottom:5px">{{orderAgg?.order_total}} orders</div>
</div> -->
<div style="text-align: center; width: 100%; text-align: center; background:white; padding-top:5px">
  <div style="font-size: 14px; padding-bottom:2px">Rating</div>
  <div style="font-size: 30px; padding-bottom:2px"><ion-icon name="star"></ion-icon><span >{{rating.rating}}</span></div>
  <div style="font-size: 14px; padding-bottom:5px"> {{rating.ratingTotal}} Review</div>
</div>
</div>

<div style="height:10px;"></div>

    <!-- <ion-item lines="none" style="font-size:14px">
        <ion-label>Filter Orders</ion-label>
        <ion-select placeholder="Select status" value="all" (ionChange)="filterOrder($event)">
          <ion-select-option value={{status}} *ngFor= "let status of orderStatus" >{{status}}</ion-select-option>
        </ion-select>
      </ion-item> -->
<!-- 
      <ion-item  [routerLink]="['/createorder']" lines="full">
        <ion-label>Create Order</ion-label>
        <ion-icon slot="end"  name="chevron-forward-outline"></ion-icon>
        <ion-icon slot="start" name="cart-outline"></ion-icon>
      </ion-item>
       -->

<ion-item (click)="deliveryListModal()" lines="full">
  <ion-label>Products to be delivered</ion-label>
  <ion-icon slot="end"  name="chevron-forward-outline"></ion-icon>
  <ion-icon slot="start" name="push-outline"></ion-icon>
</ion-item>
 
<ion-item lines="full">
  <ion-label>{{activeOrdersCount}} orders to be delivered</ion-label>
  <ion-icon slot="start" name="open-outline"></ion-icon>
</ion-item>

<ion-item lines ="none" (click)="share()">
  <ion-icon slot="start" name="link-outline"></ion-icon>
  <ion-label>Share your store on whatsapp</ion-label>
  <ion-icon slot="end" style="background:#25D366; color: white" name="logo-whatsapp" ></ion-icon>
</ion-item>


<div style="height:10px;"></div>

      <ion-item lines="none" style="font-size:14px">
        <ion-label>Filter Orders</ion-label>
        <ion-select placeholder="Select status" value="active" (ionChange)="filterOrder($event)">
          <ion-select-option value="active" >Active Orders</ion-select-option>
          <ion-select-option value="all" >All</ion-select-option>
          <ion-select-option value="pending" >Payment Pending</ion-select-option>
          <ion-select-option value="ordered" >Ordered</ion-select-option>
          <ion-select-option value="accepted" >Accepted</ion-select-option>
          <ion-select-option value="ofd" >Out For Delivery</ion-select-option>

        </ion-select>
        
      </ion-item>



<div style="height:10px;"></div>



<div *ngFor = "let order of ordersFilter; index as i"  style="position:relative">

    <div style="position: absolute; right:10px; width: 50px; height: 30px; z-index: 5" (click)="presentActionSheet(order)">
        <ion-icon style="float: right;" name="ellipsis-horizontal-outline"></ion-icon>
      </div>

    <div (click)="openOrder(order)" >
        <ion-item lines="none">
          <ion-label>
          <p>{{order.customerName}} - <span style="font-size:12px">{{order.time_formated}}</span></p>
          <div style="font-size:14px; padding-bottom:3px">#{{order.orderNo}}</div>
          <!-- <ion-chip>
              <ion-label>paid</ion-label>
            </ion-chip>

            <ion-chip>
                <ion-label>Accepted</ion-label>
              </ion-chip> -->
<span style="padding-right:10px">
              <ion-badge color="medium" >{{order.paymentStatus}}</ion-badge></span>
              <ion-badge color="light">{{order.orderStatus}}</ion-badge>

        </ion-label>
        <div>
        <div *ngIf = "!order.invoiceApproved">Rs {{order.amount}}</div>
        <div *ngIf = "order.invoiceApproved"><del style="padding-right:5px" *ngIf="order.amount != order.invoice.grandTotal">Rs {{order.amount}}</del> Rs {{order.invoice.grandTotal}}</div>
        <div *ngIf="order.rating">
        <ion-icon style="color:#fc8019" [name]="order.rating.currentRating >= 1?'star':'star-outline'">
        </ion-icon><ion-icon  style="color:#fc8019" [name]="order.rating.currentRating >= 2?'star':'star-outline'">
        </ion-icon><ion-icon style="color:#fc8019" [name]="order.rating.currentRating >= 3?'star':'star-outline'">
        </ion-icon><ion-icon style="color:#fc8019" [name]="order.rating.currentRating >= 4?'star':'star-outline'">
        </ion-icon><ion-icon style="color:#fc8019" [name]="order.rating.currentRating >= 5?'star':'star-outline'">
        </ion-icon></div>
        
      </div>

        </ion-item>
        <ion-item style="font-size:12px">
            <ion-icon name="location-outline"></ion-icon>
            <ion-label style="white-space: normal !important;" >
                {{order.address.houseNo}} {{order.address.landmark}} 
              </ion-label >
        </ion-item>
        </div>
      </div>
        <!-- <div style="background:white">
            <ion-item>
              <ion-label>
              <div>Vishal</div>
              <div>#124578925</div>
              <ion-chip>
                  <ion-label>paid</ion-label>
                </ion-chip>
    
                <ion-chip style="font-size:14px">
                    <ion-label>Accepted</ion-label>
                  </ion-chip> -->
    
                  <!-- <ion-badge>paid</ion-badge>
                  <ion-badge>Accepted</ion-badge> -->
    
            <!-- </ion-label>
            <div>Rs 500</div>
            </ion-item>

            sflk
            </div> -->
    

  <ion-list style="background:#EFEFEF"  *ngIf = false>
  <ion-card *ngFor = "let order of orders; index as i" >
      <div (click)="expand(i)">
    <div style="text-align:center; background: coral ; color:white" *ngIf = "order.paymentMode == 'cash'" >Pay on delivery</div>
    <div style="text-align:center; background:lightgreen; color:white" *ngIf = "order.paymentMode == 'online'">Online payment</div>

  <ion-item lines="none">
    <ion-label>
    <div>{{order.customerName}}</div>
    <p>phone :{{order.customerPhone}}</p>
    <p>#{{order.orderNo}} - {{order.time_formated}}</p>
    
  </ion-label>
  <!-- <div style="margin-right:15px">Rs {{order.amount}}</div> -->

  <div>
      <div style="margin-right:15px; text-align: center"><div> Rs {{order.amount}}</div></div>

      <div>
        <span style="background:coral; line-height: 30px; border-radius: 3px; padding:3px; color:white"> {{order.orderStatus}}</span>
        <div>
        <!-- <span style="background:coral; line-height: 30px; border-radius: 3px; padding:3px; color:white">unpaid</span> -->
      </div>
      </div>
      
    </div>

    
  </ion-item>
</div>
  <!-- <div style="padding-left:15px;">
    <p  [style.color] = "order.paymentStatus == 'paid'?'green':'red'"> 
      <span style="padding-right:50px">      
        payment : {{order.paymentStatus}}
      </span>
      <ion-button fill="clear" *ngIf = "order.paymentStatus == 'pending' || order.paymentStatus == 'processing'" (click)="presentAlertConfirm(order)">
        mark as paid
      </ion-button>
      </p>

  </div> -->

  <ion-item>
    <ion-label [style.color] = "order.paymentStatus == 'paid'?'green':'red'">payment : {{order.paymentStatus}}</ion-label>
    <ion-button fill="clear" *ngIf = "order.paymentStatus == 'pending' || order.paymentStatus == 'processing'" (click)="presentAlertConfirm(order)">
        mark as paid
      </ion-button>
      <!-- <ion-button (click)="createInvoice(order)"  *ngIf = "(order.orderStatus == 'Delivered') || (order.orderStatus == 'Accepted') || (order.orderStatus == 'Out For Delivery')">
          <span *ngIf = "!order.invoiceApproved">create</span> &nbsp;  invoice 
      </ion-button> -->
        </ion-item>


  <!-- <div style="padding-left:15px; padding-bottom: 10px; display:flex">
    <div style="flex-grow:1">
  <ion-icon name="location-outline" style="padding-right:5px"></ion-icon>
  <span>{{order.address.houseNo}} {{order.address.landmark}}</span>
</div> -->
<!-- <span (click)="createInvoice(order)" style="color:coral; padding: 10px" *ngIf = "(order.orderStatus == 'Delivered') || (order.orderStatus == 'Accepted') || (order.orderStatus == 'Out For Delivery')">
    <span *ngIf = "!order.invoiceApproved">create</span>  invoice 
</span> -->
<!-- </div> -->


<ion-item lines="none" >
    <ion-icon slot="start" name="location-outline" style="padding-right:5px"></ion-icon>
    <ion-label style="white-space: normal !important;" >
    {{order.address.houseNo}} {{order.address.landmark}} 
  </ion-label > 
    <ion-button (click)="createInvoice(order)"  *ngIf = "(order.orderStatus == 'Delivered') || (order.orderStatus == 'Accepted') || (order.orderStatus == 'Out For Delivery')">
        <span *ngIf = "!order.invoiceApproved">create</span> &nbsp;  invoice 
    </ion-button>

</ion-item>

  <div class="items" *ngIf = "order.expand">
    <div style="padding:10px"> <span>{{order.address.formatted_address}}</span></div>
     
      <ion-item *ngFor = "let item of order.cart, index as j" >
        <ion-label style="white-space: normal !important;" ><p>{{item.name}} - {{item.variants[item.selectedVariant].title}}</p></ion-label>
        <span>Rs. {{item.price}}</span><span>&times;{{item.qty}}</span>
        <ion-icon style="color:darkgreen" name="checkmark-circle-outline" (click)="acceptItem(order.cart, i,j)" *ngIf="!item.hasOwnProperty(status) && !(item.status == 'rejected')" > </ion-icon>
      <ion-icon style="color:red" name="close-circle-outline" (click)="rejectItem(order.cart, i, j)" *ngIf="!item?.hasOwnProperty(status) && !(item.status == 'accepted') "></ion-icon>
      </ion-item>
      
    </div>


    <div style="display:flex;"  *ngIf = "order.orderStatus == 'ordered'">
      
      <div style="flex-grow: 1">
        <ion-button expand="full" color = "medium" size="small" (click)="rejectOrder(order)">Reject</ion-button>
      </div>
      <div style="flex-grow: 1">
      <ion-button expand="full" size="small" (click)="acceptOrder(order)">Accept</ion-button>
      </div>
    
    </div>

    <div  *ngIf = "order.orderStatus == 'Accepted'">
        <ion-button expand="full" color = "medium" size="small" (click)="ourForDeliveryOrder(order)">Out For delivery</ion-button>
    </div>

    <div  *ngIf = "order.orderStatus == 'Out For Delivery'">
        <ion-button expand="full" color = "medium" size="small" (click)="deliveredOrder(order)">Delivered</ion-button>
    </div>
  <!-- <div style="border-bottom: 1px solid black"></div> -->

  </ion-card>
</ion-list>

<!-- No Orders Screen -->
<div style=" height: 100%;" *ngIf = false>
  <div style="display:flex; flex-direction:column; height: 100%">
    <div style="flex-grow:1; "></div>
    <div style="text-align: center"><h2>No Orders</h2></div>
    <div style="flex-grow:1"></div>
</div>
</div>
</div>
</ion-content>
